# 資料結構規格書
## Data Structure Specification

**版本：** v1.0
**適用範圍：** 數位化兵棋部署與沙盤推演系統

---

## 一、核心資料類型

### 1.1 基礎型別定義

```typescript
/**
 * 三維向量
 */
interface Vector3 {
  x: number;
  y: number;
  z: number;
}

/**
 * 歐拉角（度）
 */
interface EulerAngles {
  x: number;  // 俯仰角 (Pitch), -90 ~ 90
  y: number;  // 偏航角 (Yaw), 0 ~ 360
  z: number;  // 滾轉角 (Roll), -180 ~ 180
}

/**
 * 顏色（HEX 或 RGB）
 */
type Color = string;  // 格式: "#RRGGBB" 或 "rgb(r,g,b)"

/**
 * 座標系統
 */
enum CoordinateSystem {
  WGS84 = 'wgs84',      // 經緯度座標
  CARTESIAN = 'cartesian', // 笛卡兒座標（公尺）
  RELATIVE = 'relative'   // 相對座標
}

/**
 * 經緯度座標
 */
interface LatLon {
  lat: number;  // 緯度, -90 ~ 90
  lon: number;  // 經度, -180 ~ 180
  alt?: number; // 高度（公尺）, 選填
}
```

---

## 二、單位資料結構

### 2.1 單位物件 (Unit Object)

完整單位資料結構：

```typescript
/**
 * 單位物件（完整版）
 */
interface Unit {
  // ========== 基本識別 ==========
  /**
   * 唯一識別碼
   * 格式: "u-{timestamp}-{random}"
   * 範例: "u-1703685120-a3f2b1c4"
   */
  uuid: string;

  /**
   * 單位名稱
   * 範例: "第1戰車營第1連"
   */
  name: string;

  /**
   * 呼號（無線電呼號）
   * 範例: "Alpha-1", "Viper-2"
   */
  callsign?: string;

  /**
   * 父節點 UUID（用於 ORBAT 層級）
   * null 表示頂層單位
   */
  parentId: string | null;

  /**
   * 子節點 UUID 列表
   */
  children: string[];

  // ========== 兵棋符號 ==========
  /**
   * 20碼 SIDC 代碼
   * 標準: APP-6D / MIL-STD-2525
   *
   * 位置說明:
   * 位置  1: 標準版本 (3=MIL-STD-2525D)
   * 位置  2: 身份 (0=友軍, 1=敵軍, 2=中立, 3=未知)
   * 位置  3: 戰鬥態樣 (0=現實, 1=演習, 2=模擬)
   * 位置 4-5: 領域 (10=陸戰, 30=空戰, 50=海戰)
   * 位置 6-10: 實體類型
   * 位置 11-14: 特定類型
   * 位置 15-17: 修飾符
   * 位置 18-20: 狀態
   *
   * 範例: "30031000151211000020" (友軍演習裝甲單位)
   */
  sidc: string;

  /**
   * 符號大小覆寫（像素）
   * null 表示使用預設值
   */
  symbolSize?: number | null;

  /**
   * 符號顏色覆寫
   * null 表示使用身份預設色（友軍=藍, 敵軍=紅）
   */
  symbolColor?: Color | null;

  // ========== 3D 視覺資產 ==========
  /**
   * 3D 模型配置
   */
  asset: AssetConfig;

  /**
   * 視覺顯示設定
   */
  visual: VisualConfig;

  // ========== 空間變換 ==========
  /**
   * 空間變換資料
   */
  transform: Transform;

  // ========== 單位屬性 ==========
  /**
   * 單位基本屬性
   */
  properties: UnitProperties;

  // ========== 戰鬥狀態 ==========
  /**
   * 戰鬥狀態
   */
  combat: CombatStatus;

  // ========== 移動與路徑 ==========
  /**
   * 移動資料
   */
  movement: MovementData;

  // ========== 時間維度 ==========
  /**
   * 時間相關資料
   */
  temporal: TemporalData;

  // ========== 元資料 ==========
  /**
   * 自訂欄位與擴展資料
   */
  metadata: Record<string, any>;

  /**
   * 建立時間戳
   */
  createdAt: string;

  /**
   * 最後更新時間戳
   */
  updatedAt: string;
}
```

### 2.2 資產配置 (AssetConfig)

```typescript
/**
 * 3D 資產配置
 */
interface AssetConfig {
  /**
   * 模型類型
   */
  type: AssetType;

  /**
   * 模型檔案路徑（相對於 public/assets/models/）
   * 範例: "vehicles/m1a2_sepv3.glb"
   */
  modelPath: string;

  /**
   * 縮放比例
   * 預設: 1.0
   */
  scale: number;

  /**
   * 動畫配置
   */
  animations?: AnimationConfig[];

  /**
   * 材質覆寫（可選）
   */
  materialOverrides?: MaterialOverride[];
}

/**
 * 資產類型
 */
enum AssetType {
  VEHICLE = 'vehicle',       // 載具
  INFANTRY = 'infantry',     // 步兵
  AIRCRAFT = 'aircraft',     // 飛行器
  NAVAL = 'naval',          // 艦艇
  STRUCTURE = 'structure',   // 結構物/建築
  EQUIPMENT = 'equipment'    // 裝備
}

/**
 * 動畫配置
 */
interface AnimationConfig {
  /**
   * 動畫名稱
   * 範例: "idle", "moving", "firing"
   */
  name: string;

  /**
   * 是否循環播放
   */
  loop: boolean;

  /**
   * 播放速度
   * 預設: 1.0
   */
  speed: number;
}

/**
 * 材質覆寫
 */
interface MaterialOverride {
  /**
   * 材質目標（模型中的材質名稱或索引）
   */
  target: string | number;

  /**
   * 漫反射貼圖
   */
  diffuseMap?: string;

  /**
   * 金屬度 (0-1)
   */
  metalness?: number;

  /**
   * 粗糙度 (0-1)
   */
  roughness?: number;

  /**
   * 發光顏色
   */
  emissive?: Color;
}
```

### 2.3 視覺配置 (VisualConfig)

```typescript
/**
 * 視覺顯示設定
 */
interface VisualConfig {
  /**
   * LOD 距離閾值（公尺）
   * 超過此距離時切換至下一 LOD 級別
   * null 表示使用全域預設值
   */
  lodThreshold?: number | null;

  /**
   * 標籤偏移高度（公尺）
   * 符號/標籤相對於模型底部的高度
   * 預設: 5
   */
  labelOffset: number;

  /**
   * 是否顯示標籤
   */
  showLabel: boolean;

  /**
   * 是否顯示戰損狀態
   */
  showDamageState: boolean;

  /**
   * 是否始終顯示微型符號（即使近距離）
   */
  alwaysShowSymbol: boolean;

  /**
   * 自訂標籤文字
   * null 表示使用單位名稱
   */
  customLabel?: string | null;
}
```

### 2.4 空間變換 (Transform)

```typescript
/**
 * 空間變換資料
 */
interface Transform {
  /**
   * 世界座標位置（公尺）
   * Y 軸為高度軸，通常由地形高度決定
   */
  position: Vector3;

  /**
   * 旋轉角度（度）
   * Y 軸旋轉決定單位朝向
   */
  rotation: EulerAngles;

  /**
   * 縮放比例
   * 預設: { x: 1, y: 1, z: 1 }
   */
  scale?: Vector3;

  /**
   * 對應的經緯度座標（可選）
   * 當使用真實地形時使用
   */
  latLon?: LatLon;
}
```

### 2.5 單位屬性 (UnitProperties)

```typescript
/**
 * 單位基本屬性
 */
interface UnitProperties {
  /**
   * 層級等級
   */
  level: UnitLevel;

  /**
   * 隸屬兵種
   */
  branch: ServiceBranch;

  /**
   * 指揮官姓名
   */
  commander?: string;

  /**
   * 實兵人數（單位：人）
   */
  strength: number;

  /**
   * 編制人數（單位：人）
   */
  authorizedStrength: number;

  /**
   * 滿員率（百分比）
   * 計算: strength / authorizedStrength * 100
   */
  fillRate: number;

  /**
   * 裝備清單
   */
  equipment: Equipment[];

  /**
   * 補給狀態
   */
  supply: SupplyStatus;

  /**
   * 通訊狀態
   */
  communication: CommunicationStatus;

  /**
   * 備註
   */
  notes?: string;
}

/**
 * 單位層級
 */
enum UnitLevel {
  // 戰略層級
  THEATER = 'theater',       // 戰區
  ARMY = 'army',             // 軍團
  CORPS = 'corps',           // 軍

  // 作戰層級
  DIVISION = 'division',     // 師
  BRIGADE = 'brigade',       // 旅
  REGIMENT = 'regiment',     // 團

  // 戰術層級
  BATTALION = 'battalion',   // 營
  COMPANY = 'company',       // 連
  PLATOON = 'platoon',       // 排
  SQUAD = 'squad',          // 班
  TEAM = 'team',            // 火力組
  VEHICLE = 'vehicle'       // 單車/單兵
}

/**
 * 兵種
 */
enum ServiceBranch {
  ARMY = 'army',           // 陸軍
  NAVY = 'navy',           // 海軍
  AIR_FORCE = 'air_force', // 空軍
  MARINE = 'marine',       // 海軍陸戰隊
  SPECIAL_FORCES = 'special_forces', // 特種部隊
  COAST_GUARD = 'coast_guard' // 海巡
}

/**
 * 裝備項目
 */
interface Equipment {
  /**
   * 裝備類型
   */
  type: EquipmentType;

  /**
   * 裝備名稱/型號
   * 範例: "M1A2 SEPv3", "M2A3 Bradley"
   */
  name: string;

  /**
   * 數量
   */
  quantity: number;

  /**
   * 作戥狀態
   */
  status: EquipmentStatus;
}

/**
 * 裝備類型
 */
enum EquipmentType {
  MAIN_BATTLE_TANK = 'mbt',           // 主戰車
  ARMORED_FIGHTING_VEHICLE = 'afv',   // 裝甲戰鬥車
  INFANTRY_FIGHTING_VEHICLE = 'ifv',  // 步兵戰鬥車
  ARMORED_PERSONNEL_CARRIER = 'apc',  // 裝甲運兵車
  SELF_PROPELLED_ARTILLERY = 'spa',   // 自走砲
  TOWED_ARTILLERY = 'towed_artillery', // 牽引砲
  MLRS = 'mlrs',                      // 多管火箭
  AIR_DEFENSE = 'air_defense',        // 防空系統
  ATTACK_HELI = 'attack_heli',        // 攻擊直升機
  UTILITY_HELI = 'utility_heli',      // 通用直升機
  FIGHTER_JET = 'fighter_jet',        // 戰鬥機
  TRANSPORT_AIRCRAFT = 'transport_aircraft', // 運輸機
  UAV = 'uav',                        // 無人機
  FRIGATE = 'frigate',                // 巡防艦
  DESTROYER = 'destroyer',            // 驅逐艦
  AIRCRAFT_CARRIER = 'carrier',       // 航空母艦
  SMALL_BOAT = 'small_boat',          // 小艇
  INFANTRY_WEAPON = 'infantry_weapon' // 步兵武器
}

/**
 * 裝備狀態
 */
enum EquipmentStatus {
  OPERATIONAL = 'operational',     // 作戥中
  MAINTENANCE = 'maintenance',     // 維修中
  DAMAGED = 'damaged',            // 損壞
  DESTROYED = 'destroyed',        // 摧毀
  OUT_OF_SERVICE = 'out_of_service' // 報廢
}

/**
 * 補給狀態
 */
interface SupplyStatus {
  /**
   * 燃料（百分比）
   * 範圍: 0-100
   */
  fuel: number;

  /**
   * 彈藥（百分比）
   * 範圍: 0-100
   */
  ammunition: number;

  /**
   * 糧食/水（百分比）
   * 範圍: 0-100
   */
  provisions: number;

  /**
   * 整體補給狀態
   * 自動計算最低值
   */
  overall: SupplyLevel;
}

/**
 * 補給等級
 */
enum SupplyLevel {
  CRITICAL = 'critical',   // < 25%
  LOW = 'low',            // 25-50%
  ADEQUATE = 'adequate',  // 50-75%
  FULL = 'full'           // > 75%
}

/**
 * 通訊狀態
 */
interface CommunicationStatus {
  /**
   * 是否通暢
   */
  connected: boolean;

  /**
   * 通訊品質
   */
  quality: CommunicationQuality;

  /**
   * 最後通訊時間
   * ISO 8601 格式
   */
  lastContact?: string;
}

/**
 * 通訊品質
 */
enum CommunicationQuality {
  EXCELLENT = 'excellent',  // 優
  GOOD = 'good',           // 良
  DEGRADED = 'degraded',   // 劣
  LOST = 'lost'            // 失聯
}
```

### 2.6 戰鬥狀態 (CombatStatus)

```typescript
/**
 * 戰鬥狀態
 */
interface CombatStatus {
  /**
   * 當前任務/態勢
   */
  posture: CombatPosture;

  /**
   * 是否接敵（與敵軍交火中）
   */
  inContact: boolean;

  /**
   * 戰備狀態
   */
  readiness: ReadinessLevel;

  /**
   * 戰鬥效能（百分比）
   * 範圍: 0-100
   * 綜合考量人員、裝備、補給狀態
   */
  combatEffectiveness: number;

  /**
   * 被壓制程度（百分比）
   * 範圍: 0-100
   * 100 表示完全失去機動能力
   */
  suppression: number;

  /**
   * 已知威脅數量
   */
  knownThreats: number;

  /**
   * 傷亡狀態
   */
  casualties: CasualtyStatus;
}

/**
 * 戰鬥態勢
 */
enum CombatPosture {
  ATTACK = 'attack',       // 攝擊
  DEFEND = 'defend',       // 防禦
  DELAY = 'delay',         // 遲滯
  WITHDRAW = 'withdraw',   // 撤退
  SCREEN = 'screen',       // 掩護
  GUARD = 'guard',         // 警戒
  RESERVE = 'reserve',     // 預備隊
  REST = 'rest',          // 休息整補
  RECONNAISSANCE = 'recon' // 偵查
}

/**
 * 戰備等級
 */
enum ReadinessLevel {
  FULL = 'full',           // 完全戰備
  REDUCED = 'reduced',     // 減少戰備
  DEGRADED = 'degraded',   // 戰力下降
  CRITICAL = 'critical'    // 戰力危急
}

/**
 * 傷亡狀態
 */
interface CasualtyStatus {
  /**
   * 陣亡人數
   */
  kia: number;  // Killed In Action

  /**
   * 受傷人數
   */
  wia: number;  // Wounded In Action

  /**
   * 失蹤人數
   */
  mia: number;  // Missing In Action

  /**
   * 總傷亡率（百分比）
   */
  totalRate: number;
}
```

### 2.7 移動資料 (MovementData)

```typescript
/**
 * 移動資料
 */
interface MovementData {
  /**
   * 當前移動狀態
   */
  state: MovementState;

  /**
   * 移動路徑（有序路徑點列表）
   * 空陣列表示無預定路徑
   */
  path: PathPoint[];

  /**
   * 當前速度（公里/小時）
   */
  currentSpeed: number;

  /**
   * 最大速度（公里/小時）
   */
  maxSpeed: number;

  /**
   * 陣型（多單位編組移動時）
   */
  formation: FormationType;

  /**
   * 預計到達時間（可選）
   * ISO 8601 格式
   */
  eta?: string;
}

/**
 * 移動狀態
 */
enum MovementState {
  STATIONARY = 'stationary',  // 駐止
  MOVING = 'moving',         // 移動中
  HALTED = 'halted',         // 暫停
  EMBARKING = 'embarking',   // 裝載中
  DISEMBARKING = 'disembarking' // 卸載中
}

/**
 * 路徑點
 */
interface PathPoint {
  /**
   * 路徑點位置
   */
  position: Vector3;

  /**
   * 對應經緯度（可選）
   */
  latLon?: LatLon;

  /**
   * 預計到達時間（可選）
   */
  eta?: string;

  /**
   * 在此點的停留時間（秒）
   * 0 表示不停留
   */
  dwellTime: number;

  /**
   * 路徑點類型
   */
  type: PathPointType;

  /**
   * 路徑點名稱/備註
   */
  name?: string;
}

/**
 * 路徑點類型
 */
enum PathPointType {
  WAYPOINT = 'waypoint',       // 航路點
  CHECKPOINT = 'checkpoint',   // 檢查點
  RALLY_POINT = 'rally_point', // 集結點
  OBJECTIVE = 'objective'      // 目標點
}

/**
 * 陣型類型
 */
enum FormationType {
  COLUMN = 'column',       // 縱隊
  LINE = 'line',          // 橫隊
  ECHELON_LEFT = 'echelon_left',  // 左梯次
  ECHELON_RIGHT = 'echelon_right', // 右梯次
  WEDGE = 'wedge',        // 楔形
  VEE = 'vee',           // 倒楔形
  DIAMOND = 'diamond'     // 菱形
}
```

### 2.8 時間資料 (TemporalData)

```typescript
/**
 * 時間相關資料
 */
interface TemporalData {
  /**
   * 報到時間（部署至戰場的時間）
   * ISO 8601 格式
   */
  reportTime?: string;

  /**
   * 預計撤離時間
   * ISO 8601 格式
   */
  etd?: string;

  /**
   * 時間軸事件列表
   */
  events: TimelineEvent[];

  /**
   * 在場時間（秒）
   * null 表示持續駐留
   */
  duration?: number | null;
}

/**
 * 時間軸事件
 */
interface TimelineEvent {
  /**
   * 事件唯一 ID
   */
  uuid: string;

  /**
   * 事件時間
   * ISO 8601 格式
   */
  timestamp: string;

  /**
   * 事件類型
   */
  type: EventType;

  /**
   * 事件描述
   */
  description: string;

  /**
   * 事件資料（可選）
   */
  data?: Record<string, any>;
}

/**
 * 事件類型
 */
enum EventType {
  DEPLOYMENT = 'deployment',    // 部署
  ARRIVAL = 'arrival',         // 到達
  DEPARTURE = 'departure',     // 出發
  CONTACT = 'contact',         // 接敵
  CASUALTY = 'casualty',       // 傷亡
  SUPPLY = 'supply',           // 補給
  STATUS_CHANGE = 'status_change', // 狀態變更
  CUSTOM = 'custom'            // 自訂
}
```

---

## 三、場景資料結構

### 3.1 場景物件 (Scene)

```typescript
/**
 * 完整場景資料結構
 */
interface Scene {
  /**
   * 場景名稱
   */
  name: string;

  /**
   * 場景描述
   */
  description?: string;

  /**
   * 場景 UUID
   */
  uuid: string;

  /**
   * 場景版本
   */
  version: string;

  /**
   * 建立時間
   */
  createdAt: string;

  /**
   * 最後更新時間
   */
  updatedAt: string;

  /**
   * 作者
   */
  author?: string;

  /**
   * 地形配置
   */
  terrain: TerrainConfig;

  /**
   * 所有單位（以 UUID 為鍵）
   */
  units: Record<string, Unit>;

  /**
   * 戰術標繪圖形
   */
  graphics: TacticalGraphic[];

  /**
   * 場景設定
   */
  settings: SceneSettings;

  /**
   * 環境設定
   */
  environment: EnvironmentConfig;
}
```

### 3.2 地形配置 (TerrainConfig)

```typescript
/**
 * 地形配置
 */
interface TerrainConfig {
  /**
   * 地形類型
   */
  type: TerrainType;

  /**
   * 高程資料來源
   */
  heightmap: HeightmapConfig;

  /**
   * 材質/貼圖配置
   */
  textures: TextureConfig[];

  /**
   * 水體配置（可選）
   */
  water?: WaterConfig;

  /**
   * 植被配置（可選）
   */
  vegetation?: VegetationConfig;

  /**
   * 地形尺寸（公尺）
   */
  size: {
    width: number;
    height: number;
    depth?: number;
  };

  /**
   * 高度範圍（公尺）
   */
  heightRange: {
    min: number;
    max: number;
  };

  /**
   * 座標系統
   */
  coordinateSystem: CoordinateSystem;

  /**
   * 原點經緯度（使用 WGS84 時）
   */
  origin?: LatLon;
}

/**
 * 地形類型
 */
enum TerrainType {
  HEIGHTMAP = 'heightmap',     // 高程圖
  DEM = 'dem',                // 數值高程模型
  FLAT = 'flat',              // 平面
  PROCEDURAL = 'procedural'   // 程式生成
}

/**
 * 高程圖配置
 */
interface HeightmapConfig {
  /**
   * 檔案路徑
   * 支援格式: PNG, JPG, TIF, RAW
   */
  path: string;

  /**
   * 最大高度（公尺）
   * 對應圖像白色值 (255)
   */
  maxHeight: number;

  /**
   * 最小高度（公尺）
   * 對應圖像黑色值 (0)
   */
  minHeight: number;

  /**
   * 解析度（每像素公尺數）
   * 範例: 10 表示每像素代表 10x10 公尺
   */
  resolution: number;

  /**
   * 是否反轉高度
   */
  invert?: boolean;
}

/**
 * 貼圖配置
 */
interface TextureConfig {
  /**
   * 貼圖類型
   */
  type: TextureType;

  /**
   * 檔案路徑
   */
  path: string;

  /**
   * 紋理座標範圍
   * 預設: { uMin: 0, uMax: 1, vMin: 0, vMax: 1 }
   */
  uvRange?: {
    uMin: number;
    uMax: number;
    vMin: number;
    vMax: number;
  };

  /**
   * 混合模式
   */
  blendMode?: BlendMode;

  /**
   * 混合強度 (0-1)
   */
  blendIntensity?: number;
}

/**
 * 貼圖類型
 */
enum TextureType {
  ALBEDO = 'albedo',       // 漫反射（顏色）
  NORMAL = 'normal',       // 法線貼圖
  ROUGHNESS = 'roughness', // 粗糙度
  METALLIC = 'metallic',   // 金屬度
  HEIGHT = 'height',       // 高度（視差貼圖）
  AO = 'ao',              // 環境光遮蔽
  SPLAT = 'splat'         // 混合圖層
}

/**
 * 混合模式
 */
enum BlendMode {
  NONE = 'none',
  MIX = 'mix',
  MULTIPLY = 'multiply',
  ADD = 'add',
  OVERLAY = 'overlay'
}

/**
 * 水體配置
 */
interface WaterConfig {
  /**
   * 海平面高度（公尺）
   */
  level: number;

  /**
   * 水體顏色
   */
  color: Color;

  /**
   * 透明度 (0-1)
   */
  opacity: number;

  /**
   * 是否啟用波浪
   */
  enableWaves: boolean;

  /**
   * 波浪高度（公尺）
   */
  waveHeight?: number;

  /**
   * 波浪速度
   */
  waveSpeed?: number;
}

/**
 * 植被配置
 */
interface VegetationConfig {
  /**
   * 植被密度 (0-1)
   */
  density: number;

  /**
   * 樹木模型列表
   */
  treeModels: string[];

  /**
   * 草地模型列表
   */
  grassModels?: string[];

  /**
   * 植被分佈範圍
   */
  distributionRange: {
    minHeight: number;
    maxHeight: number;
  };
}
```

### 3.3 場景設定 (SceneSettings)

```typescript
/**
 * 場景設定
 */
interface SceneSettings {
  /**
   * LOD 設定
   */
  lod: LODSettings;

  /**
   * 攝影機設定
   */
  camera: CameraSettings;

  /**
   * 顯示設定
   */
  display: DisplaySettings;

  /**
   * 互動設定
   */
  interaction: InteractionSettings;
}

/**
 * LOD 設定
 */
interface LODSettings {
  /**
   * 是否啟用 LOD
   */
  enabled: boolean;

  /**
   * 自訂 LOD 級別
   * null 表示使用預設級別
   */
  levels?: LODConfig[];
}

/**
 * 攝影機設定
 */
interface CameraSettings {
  /**
   * 初始位置
   */
  position: Vector3;

  /**
   * 初始目標點
   */
  target: Vector3;

  /**
   * 最大俯仰角（度）
   */
  maxPolarAngle?: number;

  /**
   * 最小距離（公尺）
   */
  minDistance?: number;

  /**
   * 最大距離（公尺）
   */
  maxDistance?: number;

  /**
   * 視野角度（度）
   * 預設: 60
   */
  fov?: number;
}

/**
 * 顯示設定
 */
interface DisplaySettings {
  /**
   * 顯示網格
   */
  showGrid: boolean;

  /**
   * 顯示坐標軸
   */
  showAxes: boolean;

  /**
   * 網格大小（公尺）
   */
  gridSize?: number;

  /**
   * 網格間隔（公尺）
   */
  gridDivisions?: number;

  /**
   * 顯示單位標籤
   */
  showUnitLabels: boolean;

  /**
   * 顯示戰術圖形
   */
  showTacticalGraphics: boolean;

  /**
   * 顯示路徑線
   */
  showPaths: boolean;
}

/**
 * 互動設定
 */
interface InteractionSettings {
  /**
   * 啟用拖拽部署
   */
  enableDragDrop: boolean;

  /**
   * 啟用地形吸附
   */
  enableTerrainSnap: boolean;

  /**
   * 網格對齊（公尺）
   * 0 表示不對齊
   */
  gridSize?: number;

  /**
   * 選取模式
   */
  selectionMode: SelectionMode;

  /**
   * 啟用右鍵選單
   */
  enableContextMenu: boolean;
}

/**
 * 選取模式
 */
enum SelectionMode {
  SINGLE = 'single',      // 單選
  MULTIPLE = 'multiple',  // 多選
  BOX = 'box'            // 框選
}
```

### 3.4 環境設定 (EnvironmentConfig)

```typescript
/**
 * 環境設定
 */
interface EnvironmentConfig {
  /**
   * 光源列表
   */
  lights: LightConfig[];

  /**
   * 天空盒
   */
  skybox?: SkyboxConfig;

  /**
   * 霧效
   */
  fog?: FogConfig;

  /**
   * 陰影設定
   */
  shadows: ShadowConfig;

  /**
   * 時間設定
   */
  timeOfDay?: TimeOfDay;
}

/**
 * 光源配置
 */
interface LightConfig {
  /**
   * 光源類型
   */
  type: LightType;

  /**
   * 名稱
   */
  name: string;

  /**
   * 顏色
   */
  color: Color;

  /**
   * 強度 (0-1)
   */
  intensity: number;

  /**
   * 位置
   */
  position?: Vector3;

  /**
   * 目標方向（聚光燈/平行光）
   */
  target?: Vector3;

  /**
   * 範圍（點光源/聚光燈）
   */
  range?: number;

  /**
   * 內錐角（聚光燈，度）
   */
  innerConeAngle?: number;

  /**
   * 外錐角（聚光燈，度）
   */
  outerConeAngle?: number;

  /**
   * 是否投射陰影
   */
  castShadow?: boolean;
}

/**
 * 光源類型
 */
enum LightType {
  AMBIENT = 'ambient',       // 環境光
  DIRECTIONAL = 'directional', // 平行光（太陽）
  POINT = 'point',           // 點光源
  SPOT = 'spot',             // 聚光燈
  HEMISPHERE = 'hemisphere'  // 半球光
}

/**
 * 天空盒配置
 */
interface SkyboxConfig {
  /**
   * 天空盒類型
   */
  type: SkyboxType;

  /**
   * 貼圖路徑（立方體貼圖）
   * 格式: ['right', 'left', 'top', 'bottom', 'front', 'back']
   */
  cubeMap?: string[];

  /**
   * 單一全景貼圖路徑
   */
  equirectangular?: string;

  /**
   * 天空顏色（純色模式）
   */
  color?: Color;
}

/**
 * 天空盒類型
 */
enum SkyboxType {
  CUBE_MAP = 'cube_map',         // 立方體貼圖
  EQUIRECTANGULAR = 'equirectangular', // 全景貼圖
  SOLID_COLOR = 'solid_color',   // 純色
  GRADIENT = 'gradient'          // 漸層
}

/**
 * 霧效配置
 */
interface FogConfig {
  /**
   * 霧效類型
   */
  type: FogType;

  /**
   * 顏色
   */
  color: Color;

  /**
   * 近距離
   */
  near?: number;

  /**
   * 遠距離
   */
  far?: number;

  /**
   * 密度
   */
  density?: number;
}

/**
 * 霧效類型
 */
enum FogType {
  LINEAR = 'linear',    // 線性
  EXPONENTIAL = 'exp',  // 指數
  EXPONENTIAL2 = 'exp2' // 平方指數
}

/**
 * 陰影配置
 */
interface ShadowConfig {
  /**
   * 是否啟用陰影
   */
  enabled: boolean;

  /**
   * 陰影解析度
   */
  resolution: ShadowResolution;

  /**
   * 陰影貼圖類型
   */
  type: ShadowMapType;

  /**
   * 相機範圍
   */
  cameraBounds?: {
    left: number;
    right: number;
    top: number;
    bottom: number;
  };
}

/**
 * 陰影解析度
 */
enum ShadowResolution {
  LOW = 256,
  MEDIUM = 512,
  HIGH = 1024,
  ULTRA = 2048
}

/**
 * 陰影貼圖類型
 */
enum ShadowMapType {
  BASIC = 'basic',
  PCF = 'pcf',
  PCF_SOFT = 'pcf_soft'
}

/**
 * 一天中的時間
 */
interface TimeOfDay {
  /**
   * 小時 (0-23)
   */
  hour: number;

  /**
   * 分鐘 (0-59)
   */
  minute: number;

  /**
   * 是否啟用日照循環
   */
  enableCycle: boolean;

  /**
   * 時間流速（1秒現實時間 = 遊戲內分鐘數）
   */
  timeScale: number;
}
```

---

## 四、戰術標繪資料結構

### 4.1 戰術圖形 (TacticalGraphic)

```typescript
/**
 * 戰術圖形
 */
interface TacticalGraphic {
  /**
   * 唯一 ID
   */
  uuid: string;

  /**
   * 圖形類型
   */
  type: GraphicType;

  /**
   * 名稱
   */
  name: string;

  /**
   * 圖層
   */
  layer: string;

  /**
   * 樣式
   */
  style: GraphicStyle;

  /**
   * 幾何資料
   */
  geometry: GraphicGeometry;

  /**
   * 文字標籤（可選）
   */
  label?: string;

  /**
   * 是否鎖定（禁止編輯）
   */
  locked: boolean;

  /**
   * 是否顯示
   */
  visible: boolean;

  /**
   * 建立時間
   */
  createdAt: string;

  /**
   * 元資料
   */
  metadata: Record<string, any>;
}

/**
 * 圖形類型
 */
enum GraphicType {
  // 點位
  POINT = 'point',
  WAYPOINT = 'waypoint',
  CHECKPOINT = 'checkpoint',
  RALLY_POINT = 'rally_point',
  OBJECTIVE = 'objective',

  // 線條
  LINE = 'line',
  AXIS_OF_ADVANCE = 'axis_of_advance',  // 前進軸線
  BOUNDARY = 'boundary',                 // 邊界線
  ROUTE = 'route',                      // 路線
  PHASE_LINE = 'phase_line',            // 階段線

  // 箭頭
  ARROW = 'arrow',
  ATTACK_ARROW = 'attack_arrow',        // 攝擊箭頭
  MAIN_EFFORT = 'main_effort',         // 主攻方向

  // 區域
  AREA = 'area',
  AO = 'ao',                           // 作戰區域
  FAA = 'faa',                         // 防空作戰區
  ATA = 'ata',                         // 空中總攻擊區
  NAI = 'nai',                         // 關鍵地形
  TAI = 'tai',                         // 戰術關注點

  // 特殊
  CIRCULAR = 'circular',               // 圓形區域
  ORBIT = 'orbit',                     // 軌跡（空中）

  // 文字
  TEXT = 'text',
  LABEL = 'label'
}

/**
 * 圖形樣式
 */
interface GraphicStyle {
  /**
   * 線條顏色
   */
  strokeColor: Color;

  /**
   * 填充顏色（區域）
   */
  fillColor?: Color;

  /**
   * 線條寬度（像素）
   */
  strokeWidth: number;

  /**
   * 填充不透明度 (0-1)
   */
  fillOpacity?: number;

  /**
   * 線型
   */
  lineDash?: LineDashType;

  /**
   * 是否閉合（線條）
   */
  closed?: boolean;

  /**
   * 箭頭樣式（箭頭）
   */
  arrowStyle?: ArrowStyle;

  /**
   * 標籤樣式
   */
  labelStyle?: LabelStyle;
}

/**
 * 線型
 */
type LineDashType =
  | 'solid'      // 實線 ━━━━━
  | 'dashed'     // 虛線 ┄ ┄ ┄
  | 'dotted'     // 點線 ┈ ┈ ┈
  | 'dashdot';   // 點劃線 ┄ ┈ ┄ ┈

/**
 * 箭頭樣式
 */
interface ArrowStyle {
  /**
   * 箭頭類型
   */
  type: ArrowType;

  /**
   * 箭頭大小
   */
  size: number;

  /**
   * 箭頭寬度（相對於線寬的倍數）
   */
  widthRatio: number;
}

/**
 * 箭頭類型
 */
enum ArrowType {
  OPEN = 'open',        // 開放箭頭 ▷
  FILLED = 'filled',    // 填充箭頭 ▶
  DOUBLE = 'double'     // 雙箭頭
}

/**
 * 標籤樣式
 */
interface LabelStyle {
  /**
   * 字型大小
   */
  fontSize: number;

  /**
   * 字型族
   */
  fontFamily: string;

  /**
   * 文字顏色
   */
  color: Color;

  /**
   * 背景顏色（可選）
   */
  backgroundColor?: Color;

  /**
   * 邊距
   */
  padding: number;

  /**
   * 邊框圓角
   */
  borderRadius: number;

  /**
   * 標籤位置
   */
  position: LabelPosition;
}

/**
 * 標籤位置
 */
enum LabelPosition {
  CENTER = 'center',
  START = 'start',
  END = 'end',
  ABOVE = 'above',
  BELOW = 'below'
}

/**
 * 圖形幾何
 */
interface GraphicGeometry {
  // ========== 點位 ==========
  /**
   * 點位座標
   */
  point?: Vector3;

  // ========== 線條 ==========
  /**
   * 線條節點列表
   */
  points?: Vector3[];

  /**
   * 是否平滑曲線
   */
  smooth?: boolean;

  // ========== 區域 ==========
  /**
   * 區域頂點列表
   */
  vertices?: Vector3[];

  /**
   * 是否凸多邊形
   */
  convex?: boolean;

  // ========== 圓形 ==========
  /**
   * 圓心
   */
  center?: Vector3;

  /**
   * 半徑（公尺）
   */
  radius?: number;

  /**
   * 起始角度（度）
   */
  startAngle?: number;

  /**
   * 結束角度（度）
   */
  endAngle?: number;

  // ========== 軌跡 ==========
  /**
   * 軌跡中心
   */
  orbitCenter?: Vector3;

  /**
   * 軌跡半徑
   */
  orbitRadius?: number;

  /**
   * 軌跡高度（公尺）
   */
  orbitAltitude?: number;

  // ========== 文字 ==========
  /**
   * 文字內容
   */
  text?: string;
}
```

---

## 五、匯入匯出格式

### 5.1 場景匯出格式

```typescript
/**
 * 場景匯出格式
 */
interface SceneExport {
  /**
   * 檔案格式版本
   */
  format: 'wargame-scene';

  /**
   * 版本號
   */
  version: string;

  /**
   * 場景資料
   */
  scene: Scene;

  /**
   * 匯出選項
   */
  options: ExportOptions;

  /**
   * 匯出時間戳
   */
  exportedAt: string;
}

/**
 * 匯出選項
 */
interface ExportOptions {
  /**
   * 是否包含單位模型資料
   * false 表示只保留路徑引用
   */
  includeModels: boolean;

  /**
   * 是否壓縮
   */
  compressed: boolean;

  /**
   * 是否包含元資料
   */
  includeMetadata: boolean;

  /**
   * 排除的圖層
   */
  excludeLayers: string[];
}
```

### 5.2 ORBAT 匯入格式

```typescript
/**
 * ORBAT 匯入格式
 */
interface ORBATImport {
  /**
   * 單位列表（扁平結構）
   * 層級關係透過 parentId 建構
   */
  units: UnitImportData[];

  /**
   * 匯入選項
   */
  options: {
    /**
     * 是否自動生成 UUID
     * false 表示使用提供的 uuid
     */
    autoGenerateUuid: boolean;

    /**
     * 預設座標（未指定時使用）
     */
    defaultPosition?: Vector3;

    /**
     * 預設 SIDC（未指定時使用）
     */
    defaultSidc?: string;
  };
}

/**
 * 單位匯入資料（簡化版）
 */
interface UnitImportData {
  uuid?: string;
  name: string;
  parentId?: string | null;
  sidc?: string;
  level?: UnitLevel;
  position?: Vector3;
  rotation?: EulerAngles;
  modelPath?: string;
  properties?: Partial<UnitProperties>;
}
```

---

## 六、錯誤碼定義

```typescript
/**
 * 錯誤碼
 */
enum ErrorCode {
  // ========== 通用 ==========
  UNKNOWN_ERROR = 'E0000',
  NOT_IMPLEMENTED = 'E0001',
  INVALID_ARGUMENT = 'E0002',
  OPERATION_FAILED = 'E0003',

  // ========== 單位 ==========
  UNIT_NOT_FOUND = 'E1000',
  UNIT_ALREADY_EXISTS = 'E1001',
  UNIT_INVALID_PARENT = 'E1002',
  UNIT_CIRCULAR_REFERENCE = 'E1003',
  UNIT_DELETE_HAS_CHILDREN = 'E1004',

  // ========== 符號 ==========
  SYMBOL_INVALID_SIDC = 'E2000',
 _SYMBOL_RENDER_FAILED = 'E2001',
  SYMBOL_CACHE_ERROR = 'E2002',

  // ========== 場景 ==========
  SCENE_NOT_FOUND = 'E3000',
  SCENE_LOAD_FAILED = 'E3001',
  SCENE_SAVE_FAILED = 'E3002',
  SCENE_INVALID_FORMAT = 'E3003',

  // ========== 地形 ==========
  TERRAIN_LOAD_FAILED = 'E4000',
  TERRAIN_INVALID_SIZE = 'E4001',
  TERRAIN_INVALID_HEIGHTMAP = 'E4002',

  // ========== 模型 ==========
  MODEL_NOT_FOUND = 'E5000',
  MODEL_LOAD_FAILED = 'E5001',
  MODEL_INVALID_FORMAT = 'E5002',

  // ========== 戰術圖形 ==========
  GRAPHIC_INVALID_TYPE = 'E6000',
  GRAPHIC_INVALID_GEOMETRY = 'E6001',
  GRAPHIC_TERRAIN_CLIP_FAILED = 'E6002'
}

/**
 * 錯誤物件
 */
interface Error {
  code: ErrorCode;
  message: string;
  details?: any;
}
```

---

*文件版本：v1.0*
*最後更新：2024-12-27*
