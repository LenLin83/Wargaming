# 專案架構規劃

## 三層架構

```
┌─────────────────────────────────────────────────────────────┐
│                        UI 層 (Presentation)                  │
│  負責：使用者介面、事件處理、DOM 操作                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  ui/managers/     - 各種管理器 (ORBATUI, PropertyUI) │   │
│  │  ui/components/   - UI 組件 (Button, Panel, Tree)     │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│                     前端層 (Frontend / Engine)                │
│  負責：3D 渲染、場景管理、符號生成、戰術標繪                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  frontend/core/    - 核心系統 (App, EventBus)        │   │
│  │  frontend/engine/  - 3D 引擎 (Scene3D, Renderer)    │   │
│  │  frontend/utils/   - 工具函數                         │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│                      後端層 (Backend / Data)                  │
│  負責：資料管理、業務邏輯、狀態存儲、API 模擬                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  backend/data/        - 資料模型 (Unit, Scene)        │   │
│  │  backend/services/    - 業務服務 (ORBATService)       │   │
│  │  backend/repositories/ - 資料存取 (Storage)            │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 目錄結構

```
Wargaming/
├── index.html              # 主 HTML
├── css/
│   └── styles.css          # 主樣式
│
├── backend/                # 【後端層】資料與業務邏輯
│   ├── data/               # 資料模型定義
│   │   ├── Unit.js         # 單位資料模型
│   │   ├── Scene.js        # 場景資料模型
│   │   └── TacticalGraphic.js  # 戰術圖形模型
│   ├── services/           # 業務服務
│   │   ├── ORBATService.js     # ORBAT 業務邏輯
│   │   ├── SceneService.js     # 場景業務邏輯
│   │   └── SymbolService.js    # 符號業務邏輯
│   └── repositories/       # 資料存取
│       ├── MemoryStorage.js    # 記憶體存儲
│       └── LocalStorage.js     # 本地存儲
│
├── frontend/               # 【前端層】3D 引擎與核心
│   ├── core/               # 核心系統
│   │   ├── App.js          # 應用程式主類
│   │   ├── EventBus.js     # 事件匯流排
│   │   └── Config.js       # 配置管理
│   ├── engine/             # 3D 引擎
│   │   ├── Scene3D.js      # 3D 場景管理
│   │   ├── TerrainEngine.js    # 地形引擎
│   │   ├── UnitEngine.js       # 單位引擎
│   │   ├── SymbolEngine.js     # 符號引擎
│   │   ├── TacticalEngine.js   # 戰術標繪引擎
│   │   └── RenderEngine.js     # 渲染引擎
│   └── utils/              # 工具函數
│       ├── UUID.js         # UUID 生成
│       ├── Coordinate.js   # 座標轉換
│       └── Math3D.js       # 3D 數學運算
│
├── ui/                     # 【UI 層】使用者介面
│   ├── managers/           # UI 管理器
│   │   ├── ORBATUI.js      # ORBAT 樹管理器
│   │   ├── PropertyUI.js   # 屬性面板管理器
│   │   ├── ToolbarUI.js    # 工具列管理器
│   │   └── TimelineUI.js   # 時間軸管理器
│   ├── components/         # UI 組件
│   │   ├── TreeNode.js     # 樹節點組件
│   │   ├── Button.js       # 按鈕組件
│   │   ├── Panel.js        # 面板組件
│   │   └── Dialog.js       # 對話框組件
│   └── UIManager.js        # UI 總管理器
│
├── assets/                 # 靜態資源
│   ├── models/             # 3D 模型
│   └── textures/           # 貼圖
│
├── docs/                   # 文檔
├── server.cjs              # 開發伺服器
└── package.json
```

## 模組職責

### Backend（後端層）
| 模組 | 職責 |
|------|------|
| `data/` | 資料模型定義（Unit, Scene, TacticalGraphic）|
| `services/` | 業務邏輯處理（新增、修改、刪除、查詢）|
| `repositories/` | 資料持久化（記憶體、LocalStorage）|

### Frontend（前端層）
| 模組 | 職責 |
|------|------|
| `core/App.js` | 應用程式主控，協調各層 |
| `core/EventBus.js` | 事件匯流排，層間通訊 |
| `engine/Scene3D.js` | Three.js 場景管理 |
| `engine/TerrainEngine.js` | 地形渲染與交互 |
| `engine/UnitEngine.js` | 單位 3D 實體管理 |
| `engine/SymbolEngine.js` | 軍事符號生成 |
| `engine/TacticalEngine.js` | 戰術圖形渲染 |

### UI（UI 層）
| 模組 | 職責 |
|------|------|
| `managers/ORBATUI.js` | ORBAT 樹介面管理 |
| `managers/PropertyUI.js` | 屬性面板介面管理 |
| `managers/ToolbarUI.js` | 工具列介面管理 |
| `components/` | 可重用的 UI 組件 |

## 層間通訊

```
User Input
    │
    ▼
┌─────────┐
│   UI    │  事件: ui:action
│   層    │─────────────┐
└─────────┘             │
                        ▼
                  ┌─────────┐
                  │Frontend │  指令: Service.method()
                  │   層    │─────────────┐
                  └─────────┘             │
                                          ▼
                                    ┌─────────┐
                                    │Backend  │  資料變更
                                    │   層    │─────────────┐
                                    └─────────┤             │
                                                  │         │
                                                  ▼         ▼
                                            ┌─────────┐ ┌─────────┐
                                            │ Storage │ │ Service │
                                            └─────────┘ └─────────┘
                                                  │         │
                                                  ▼         ▼
                                    事件: backend:changed  返回結果
                                    ───────────────────────────▶
                                                  │
                                          通知 Frontend 更新
                                                  │
                                          通知 UI 重新渲染
```
